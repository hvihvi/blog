---
title: TDD, Test Pyramids
date: 2022/05/03
description: Pros & Cons, rethinking popular practices...
tag: architecture, code quality, testing, productivity
author: You
---

# TDD & Test Pyramid

## TDD

Test > Code (make it work) > Refactor (make it simple)

What tends to happen when we couple it with the Test Pyramid is:

Unit Test > Code > Tests are tightly bound to the implementation, it's hard to refactor

Consequences are often:

- Early abstractions (needed to express the test)
- Low value unit tests (implementation details)
- Lots of unit tests = lots of mocks => code is hard to change
- 1 test per function/method/file/component approaches leads to unnecessary tests
- Trivial code gets tested
- "this should call this with these parameters n times" (useless coverage tests)
- Slightly slower development cycles
- "Refactor" is misunderstood as "hide behind an abstraction", adds more complexity
- We feel good for creating tests, our feedback loop is flawed
- It's hard to be the guy who deletes tests

It's great at:

- Rubber Duck Programming effect where the test plays the duck role
- Helps brute force your way through complexity (I don't know what I'm doing, but I can keep throwing code at tests until it passes)
- Actually writing tests ("test last" tend to skip writing tests and move on, just like TDD skips refactoring)

## Test Pyramid

The initial idea was to have few E2E tests and many unit tests.

The Test Pyramid has a few cons:

- Unit tests are tightly bound to the implementation => code is hard to change
- Unit tests don't reflect the user's behavior
- False positive: Changing implementation details might break the test, not the app

The trend has shifted in the past few years towards lifting tests up (ex: https://kentcdodds.com/blog/the-testing-trophy-and-testing-classifications)
Thanks to libraries like testing-library https://testing-library.com/.
Backend people are now moving in this direction as well https://www.youtube.com/watch?v=QL0HBeIAny0
